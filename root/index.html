<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U MUST LEARN</title>
    <style>
        :root { --base-font: 16px; --accent: #ffb74d; --accent-soft: #fff4e0; --card-bg: #ffffff; --brand-icon-url: url("./assets/MainIcon.png"); --content-max-width: 500px; --bottom-tabs-height: 56px; --body-vertical-padding: 36px; --tabbed-window-min-height: 320px; --tabbed-window-offset: 16px; }
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; max-width: 900px; margin: 0 auto; padding: 12px 12px 24px; line-height: 1.5; font-size: var(--base-font); box-sizing: border-box; background: #f5f5f5; transition: background-color 0.15s; }
        .page { width: 100%; }
        #course-home-page, #main-page, #settings-page, #exercises-page { position: relative; z-index: 5; }
        .landing-shell { max-width: 760px; margin: 22px auto 12px; }
        .landing-shell-compact { margin-top: 8px; margin-bottom: 12px; }
        .landing-brand-gap { --brand-gap: 22px; }
        .landing-brand-wrap {
            width: min(760px, 100%);
            margin: 0 auto var(--brand-gap, 22px);
        }
        .landing-brand-wrap::before,
        .landing-brand-wrap::after {
            content: "";
            display: block;
            height: 4px;
            width: 100%;
            border-radius: 999px;
            background: linear-gradient(90deg, #ff5db1, #a94dff);
            opacity: 0.88;
        }
        .landing-brand-wrap::before { margin-bottom: 14px; }
        .landing-brand-wrap::after { margin-top: 14px; }
        .landing-brand {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.14em;
            text-align: center;
            margin: 0;
            font-size: clamp(2.05rem, 7vw, 3rem);
            line-height: 1.05;
            font-weight: 900;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: #3f2458;
        }
        .landing-brand-icon {
            display: inline-block;
            line-height: 1;
            font-size: 0.56em;
            transform: translateY(-0.16em);
            opacity: 0.8;
        }
        .landing-brand-icon::before {
            content: "...";
        }
        html.brand-icon-ready .landing-brand-icon {
            width: 0.9em;
            height: 0.9em;
            font-size: 1em;
            transform: translateY(-0.02em);
            background-color: currentColor;
            opacity: 0.9;
            -webkit-mask-image: var(--brand-icon-url);
            mask-image: var(--brand-icon-url);
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-position: center;
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-source-type: alpha;
            mask-mode: alpha;
        }
        html.brand-icon-ready .landing-brand-icon::before {
            content: "";
        }
        .home-content {
            max-width: 760px;
            margin: 0 auto;
            background: var(--card-bg, #fff);
            border: 1px solid #e0e0e0;
            border-radius: 18px;
            padding: 30px 24px 28px;
            box-shadow: 0 14px 34px rgba(0, 0, 0, 0.11);
        }
        .landing-card { position: relative; }
        .landing-card-title {
            margin: 0 0 10px;
            text-align: center;
            font-size: clamp(1.35rem, 3.8vw, 1.95rem);
            line-height: 1.2;
            font-weight: 700;
            letter-spacing: 0.005em;
            text-transform: none;
            color: #3f2458;
        }
        .home-info { text-align: center; color: #555; margin: 0 auto 20px; max-width: 60ch; line-height: 1.45; font-size: 1.06rem; }
        .home-actions { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; width: min(560px, 100%); margin: 0 auto; }
        .home-actions button { width: 100%; min-width: 0; min-height: 48px; }
        .home-actions button.hero-action-wide,
        .main-quick-actions button.hero-action-wide { grid-column: 1 / -1; justify-self: center; width: min(320px, 100%); }
        .main-header-card { max-width: 760px; padding: 30px 24px 28px; }
        .main-quick-actions { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; width: min(560px, 100%); margin: 0 auto; }
        .main-quick-actions button { width: 100%; min-height: 48px; }
        .training-quick-actions {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 8px;
            margin: 2px 0 8px;
        }
        .training-quick-actions button {
            min-width: 0;
            min-height: 34px;
            padding: 6px 10px;
            font-size: 0.82rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        @media (max-width: 600px) {
            .landing-shell { margin-top: 10px; }
            .landing-brand-gap { --brand-gap: 14px; }
            .landing-brand-wrap::before,
            .landing-brand-wrap::after { height: 3px; }
            .landing-brand-wrap::before { margin-bottom: 10px; }
            .landing-brand-wrap::after { margin-top: 10px; }
            .landing-brand { font-size: clamp(1.8rem, 9.2vw, 2.45rem); }
            .home-content,
            .main-header-card { border-radius: 16px; padding: 24px 16px 22px; }
            .landing-card-title { font-size: clamp(1.3rem, 6.2vw, 1.8rem); }
            .home-info { font-size: 1rem; margin-bottom: 16px; }
            .home-actions,
            .main-quick-actions { gap: 10px; }
            .training-quick-actions { gap: 6px; margin-bottom: 6px; }
            .training-quick-actions button { min-height: 32px; padding: 5px 8px; font-size: 0.76rem; }
        }
        @media (max-width: 430px) {
            .home-actions,
            .main-quick-actions { grid-template-columns: 1fr; }
            .home-actions button.hero-action-wide,
            .main-quick-actions button.hero-action-wide { grid-column: auto; width: 100%; }
            .training-quick-actions button { font-size: 0.72rem; }
        }
        .settings-content { max-width: var(--content-max-width, 500px); width: 100%; margin: 40px auto; background: var(--card-bg, #fff); border: 1px solid #e0e0e0; border-radius: 12px; padding: 40px 32px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); box-sizing: border-box; }
        #settings-page .settings-content { max-width: var(--content-max-width, 500px); width: 100%; box-sizing: border-box; margin: 12px auto 0; height: calc(100dvh - var(--body-vertical-padding) - var(--bottom-tabs-height) - 12px); max-height: calc(100dvh - var(--body-vertical-padding) - var(--bottom-tabs-height) - 12px); overflow-y: auto; overflow-x: hidden; }
        .tabbed-window #settings-page .settings-content { flex: 1 1 auto; min-height: 0; margin: 0; height: auto; max-height: none; overflow-y: auto; overflow-x: hidden; padding: 24px 20px; display: flex; flex-direction: column; }
        #settings-page .settings-content h1 { text-align: center; margin: 0 0 40px 0; font-size: 1.5rem; }
        #settings-toolbar { display: flex; flex-direction: column; gap: 20px; margin-bottom: 40px; }
        .settings-group { display: flex; justify-content: center; width: 100%; }
        .settings-group select, .settings-group .settings-btn { width: 100%; max-width: 300px; }
        #btn-exercises-back { display: none !important; }
        #btn-settings-back { display: none !important; }
        #btn-settings-back.force-show { display: block !important; margin: 0 auto; width: 100%; max-width: 300px; }
        #exercises-page .settings-content {
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            max-width: var(--content-max-width, 500px);
            width: 100%;
            margin: 12px auto 0;
            height: calc(100dvh - var(--body-vertical-padding) - var(--bottom-tabs-height) - 12px);
            max-height: calc(100dvh - var(--body-vertical-padding) - var(--bottom-tabs-height) - 12px);
            overflow: hidden;
        }
        .tabbed-window #exercises-page .settings-content { flex: 1 1 auto; min-height: 0; margin: 0; height: auto; max-height: none; padding: 16px 20px 12px; }
        #exercises-page .settings-content h1 { text-align: center; margin: 0 0 12px 0; font-size: 1.5rem; }
        #exercises-subtitle { text-align: center; color: #666; font-size: 0.92rem; margin-bottom: 20px; }
        #exercise-buttons {
            --exercise-diameter: clamp(78px, 9.5vh, 102px);
            --exercise-zigzag-shift: calc(var(--exercise-diameter) * 0.4);
            --exercise-gap: calc(var(--exercise-diameter) / 2);
            --exercise-focus-safe-space: 18px;
            --scroll-track-bg: linear-gradient(180deg, #ececf2, #e3e4ee);
            --scroll-track-border: rgba(106, 90, 205, 0.28);
            --scroll-thumb-bg: linear-gradient(180deg, #7b6ad8, #6453c9);
            --scroll-thumb-border: rgba(67, 58, 126, 0.62);
            --scroll-thumb-shadow: 0 0 8px rgba(106, 90, 205, 0.3);
            --scroll-thumb-hover: linear-gradient(180deg, #8a7ae2, #7061d2);
            display: flex;
            flex-direction: column;
            align-items: center;
            row-gap: var(--exercise-gap);
            flex: 1 1 auto;
            min-height: 0;
            overflow-y: auto;
            overflow-x: hidden;
            padding: var(--exercise-focus-safe-space) 0 calc(10px + var(--exercise-focus-safe-space));
            margin-bottom: 8px;
            scroll-padding-top: var(--exercise-focus-safe-space);
            scroll-padding-bottom: var(--exercise-focus-safe-space);
            scrollbar-width: thin;
            scrollbar-color: #6a5acd #e4e5ef;
        }
        #exercise-buttons::-webkit-scrollbar { width: 10px; }
        #exercise-buttons::-webkit-scrollbar-track {
            background: var(--scroll-track-bg);
            border-radius: 999px;
            border: 1px solid var(--scroll-track-border);
        }
        #exercise-buttons::-webkit-scrollbar-thumb {
            background: var(--scroll-thumb-bg);
            border-radius: 999px;
            border: 1px solid var(--scroll-thumb-border);
            box-shadow: var(--scroll-thumb-shadow);
        }
        #exercise-buttons::-webkit-scrollbar-thumb:hover {
            background: var(--scroll-thumb-hover);
        }
        body.theme-cyberpunk #exercise-buttons {
            --scroll-track-bg: linear-gradient(180deg, rgba(6, 12, 28, 0.9), rgba(10, 18, 40, 0.95));
            --scroll-track-border: rgba(0, 234, 255, 0.2);
            --scroll-thumb-bg: linear-gradient(180deg, rgba(0, 234, 255, 0.9), rgba(0, 170, 255, 0.85));
            --scroll-thumb-border: rgba(0, 18, 36, 0.65);
            --scroll-thumb-shadow: 0 0 10px rgba(0, 234, 255, 0.35);
            --scroll-thumb-hover: linear-gradient(180deg, rgba(60, 245, 255, 0.98), rgba(40, 190, 255, 0.95));
            scrollbar-color: rgba(0, 234, 255, 0.75) rgba(7, 14, 34, 0.85);
        }
        body.theme-kawaii #exercise-buttons {
            --scroll-track-bg: linear-gradient(180deg, #f8eefd, #f2e2fa);
            --scroll-track-border: rgba(233, 86, 195, 0.28);
            --scroll-thumb-bg: linear-gradient(180deg, #ff69cb, #b04fe8);
            --scroll-thumb-border: rgba(115, 36, 138, 0.52);
            --scroll-thumb-shadow: 0 0 10px rgba(233, 86, 195, 0.28);
            --scroll-thumb-hover: linear-gradient(180deg, #ff7fd4, #bf60ef);
            scrollbar-color: #d954b7 #f3e5fb;
        }
        .exercise-nav-btn {
            border-radius: 50% !important;
            width: var(--exercise-diameter);
            height: var(--exercise-diameter);
            min-width: var(--exercise-diameter);
            min-height: var(--exercise-diameter);
            aspect-ratio: 1 / 1;
            flex: 0 0 var(--exercise-diameter);
            padding: 0;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
            border-width: 4px;
        }
        #exercise-buttons .exercise-nav-btn:nth-child(odd) {
            transform: translateX(calc(var(--exercise-zigzag-shift) * -1));
        }
        #exercise-buttons .exercise-nav-btn:nth-child(even) {
            transform: translateX(var(--exercise-zigzag-shift));
        }
        @media (max-width: 600px) {
            #exercise-buttons {
                --exercise-diameter: clamp(72px, 13vw, 92px);
            }
        }
        .exercise-nav-num {
            width: 78%;
            font-size: 0.72rem;
            line-height: 1.1;
            margin-bottom: 3px;
            opacity: 0.95;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .exercise-nav-title {
            display: -webkit-box;
            width: 78%;
            line-height: 1.2;
            font-size: 0.78rem;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-word;
            hyphens: auto;
        }
        body.theme-cyberpunk .exercise-nav-btn { border-color: #00eaff; }
        body.theme-kawaii .exercise-nav-btn { border-color: #ff6bd5; }
        body:not(.theme-cyberpunk):not(.theme-kawaii) .exercise-nav-btn { border-color: #6a5acd; }
        .exercise-nav-btn.is-resume-target {
            border-width: 7px;
            box-shadow: 0 0 0 5px rgba(255, 255, 255, 0.2), 0 0 24px rgba(0, 234, 255, 0.65);
        }
        body.theme-cyberpunk .exercise-nav-btn.is-resume-target {
            border-color: #7dff5d;
            box-shadow: 0 0 0 5px rgba(125, 255, 93, 0.3), 0 0 24px rgba(125, 255, 93, 0.68);
        }
        body.theme-kawaii .exercise-nav-btn.is-resume-target {
            border-color: #ffd166;
            box-shadow: 0 0 0 5px rgba(255, 209, 102, 0.3), 0 0 24px rgba(255, 209, 102, 0.64);
        }
        body:not(.theme-cyberpunk):not(.theme-kawaii) .exercise-nav-btn.is-resume-target {
            border-color: #7dd3fc;
            box-shadow: 0 0 0 5px rgba(125, 211, 252, 0.3), 0 0 24px rgba(125, 211, 252, 0.58);
        }
        @media (max-width: 600px) {
            .exercise-nav-num { width: 82%; font-size: 0.68rem; }
            .exercise-nav-title { width: 82%; font-size: 0.74rem; }
        }
        .training-close-bar { display: flex; justify-content: flex-end; padding: 6px 8px 8px; margin-bottom: 4px; }
        .btn-training-close { min-width: 36px; min-height: 36px; padding: 6px 12px; font-size: 0.85rem; border-radius: 999px; }
        body.tabs-pages-visible { overflow: hidden; height: 100dvh; max-height: 100dvh; padding-top: var(--tabbed-window-offset); padding-bottom: var(--tabbed-window-offset); box-sizing: border-box; }
        html.tabs-pages-visible { overflow: hidden; height: 100%; }
        .tabbed-window {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: var(--content-max-width);
            min-height: var(--tabbed-window-min-height);
            height: calc(100dvh - 2 * var(--tabbed-window-offset));
            max-height: calc(100dvh - 2 * var(--tabbed-window-offset));
            margin: 0 auto;
            background: var(--card-bg);
            border: 1px solid #e0e0e0;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            box-sizing: border-box;
        }
        .tabbed-window-content {
            flex: 1 1 auto;
            min-height: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .tabbed-window-content #settings-page,
        .tabbed-window-content #exercises-page {
            display: none !important;
            flex: 1 1 auto;
            min-height: 0;
            flex-direction: column;
            overflow: hidden;
        }
        .tabbed-window.tab-exercises .tabbed-window-content #exercises-page { display: flex !important; }
        .tabbed-window.tab-settings .tabbed-window-content #settings-page { display: flex !important; }
        .tabbed-window .bottom-tabs { position: static; left: auto; transform: none; flex: 0 0 auto; border-radius: 0 0 12px 12px; overflow: hidden; }
        .tabbed-window-header { flex: 0 0 auto; min-height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 12px 12px 0 0; border-bottom: 2px solid rgba(0,0,0,0.08); background: var(--card-bg); box-sizing: border-box; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.02em; color: #1a1a1a; padding: 0 16px; }
        .tabbed-window-content #settings-page .settings-content h1,
        .tabbed-window-content #exercises-page .settings-content h1 { display: none !important; }
        .tabbed-window .settings-content { border-radius: 0 !important; }
        .bottom-tabs { display: flex; width: 100%; background: var(--card-bg, #fff); border-top: 1px solid #e0e0e0; box-shadow: 0 -2px 10px rgba(0,0,0,0.08); box-sizing: border-box; }
        .bottom-tabs .tab-btn { flex: 1; min-height: 48px; border: none; border-radius: 0; background: transparent; font-weight: 600; font-size: 0.95rem; cursor: pointer; border-bottom: 3px solid transparent; transition: background 0.15s, border-color 0.15s, color 0.15s; color: #1d1d1d; }
        .bottom-tabs .tab-btn:hover { background: #f0f0f0; color: #1d1d1d; }
        .bottom-tabs .tab-btn.active { border-bottom-color: var(--accent, #6a5acd); background: var(--accent-soft, #f0edff); color: #1a1a2e; }
        .app-content-wrap { padding-bottom: var(--bottom-tabs-height); min-height: 100dvh; box-sizing: border-box; }
        .app-content-wrap.tabs-pages-visible { padding-bottom: 0; padding-top: 0; max-height: calc(100dvh - 2 * var(--tabbed-window-offset)); overflow: hidden; }
        h1 { text-align: center; margin: 16px 0 4px; font-size: 1.4rem; }
        .subtitle { text-align: center; font-size: 0.9rem; color: #555; margin-bottom: 10px; }
        .warning { font-size: 0.85rem; color: #a15a00; background: var(--accent-soft); border: 1px solid var(--accent); border-radius: 10px; padding: 8px 10px; margin-bottom: 10px; }
        .top-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-bottom: 8px; }
        .block-selector-label { font-size: 0.85rem; color: #555; }
        #block-select-label, #block-select { display: none !important; }
        #explain, .toggle-explain-row { display: none !important; }
        #btn-topPanel { display: none !important; }
        select { padding: 6px 8px; border-radius: 8px; border: 1px solid #ccc; font-size: 0.9rem; background: #fff; }
        .block-header { margin: 8px 0 4px; }
        .block-title { font-weight: 700; font-size: 1.05rem; }
        .block-progress { font-size: 0.85rem; color: #666; display: flex; align-items: center; gap: 6px; }
        .progress-dot { width: 8px; height: 8px; border-radius: 999px; background: var(--accent); }
        .exercise-step { font-size: 0.9rem; margin: 6px 0 8px; color: #333; }
        .explain { background: var(--card-bg); border-radius: 12px; border: 1px solid #e0e0e0; padding: 10px 12px; margin-bottom: 12px; }
        .topic-tag { display: inline-flex; align-items: center; gap: 6px; font-size: 0.8rem; padding: 2px 8px; border-radius: 999px; background: #eef4ff; color: #244272; margin-bottom: 4px; }
        .explain h2 { margin: 2px 0 6px; font-size: 1rem; }
        .explain p, .explain ul, .explain li { margin: 4px 0; }
        .explain ul { margin-left: 18px; padding: 0; }
        .toggle-explain-row { margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; gap: 8px; }
        .card { border: 1px solid #e0e0e0; border-radius: 12px; padding: 12px; margin-bottom: 10px; background: var(--card-bg); box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        .card-title { font-weight: 600; margin-bottom: 6px; font-size: 0.95rem; }
        .label { font-size: 0.83rem; color: #555; margin-bottom: 4px; }
        .question { font-size: 1.05rem; margin-bottom: 8px; }
        .options { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
        .option-btn { text-align: left; width: 100%; border-radius: 999px; padding-left: 14px; }
        .option-btn.correct { border-color: #2e7d32; background: #e6f7e6; }
        .option-btn.wrong { border-color: #c62828; background: #ffecec; }
        .feedback { min-height: 20px; margin-bottom: 8px; font-weight: 600; font-size: 0.92rem; }
        .feedback.correct { color: #2e7d32; }
        .feedback.wrong { color: #c62828; }
        .input-row { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: nowrap; }
        input[type="text"], textarea { flex: 1 1 auto; padding: 8px 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 0.95rem; min-width: 0; font-family: inherit; resize: vertical; background: #fafafa; }
        button { padding: 9px 13px; border-radius: 999px; border: 1px solid #ccc; cursor: pointer; font-size: 0.9rem; background: #fff; transition: background 0.15s, transform 0.05s, box-shadow 0.1s; touch-action: manipulation; }
        button:hover:enabled { background: #f5f5f5; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        button:active:enabled { transform: scale(0.97); }
        button.primary { border-color: #333; background: #f0f0f0; font-weight: 600; }
        button:disabled { opacity: 0.6; cursor: default; box-shadow: none; }
        #btn-settings:disabled { opacity: 0.5; cursor: not-allowed; }
        .settings-btn { padding: 9px 13px; border-radius: 999px; border: 1px solid #ccc; cursor: pointer; font-size: 0.9rem; background: #fff; transition: background 0.15s, transform 0.05s, box-shadow 0.1s; }
        .settings-btn:hover:enabled { background: #f5f5f5; color: #222 !important; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .settings-btn:active:enabled { transform: scale(0.97); }
        .settings-btn.dev-mode-active { border-color: #333; background: #f0f0f0; font-weight: 600; }
        .next-ex-btn-wrap { display: flex; justify-content: space-between; gap: 8px; margin-bottom: 8px; margin-top: 4px; }
        .stats { font-size: 0.8rem; color: #555; background: #fff; border-radius: 8px; border: 1px solid #ddd; padding: 6px 8px; margin-top: 6px; }
        #stage-bar-wrap { height: 10px; width: 100%; border-radius: 999px; background: #e6e6e6; overflow: hidden; margin: 10px 0 8px; border: 1px solid #ddd; }
        #stage-bar { height: 100%; width: 0%; background: #ff4d4d; border-radius: 999px; transition: width 0.25s ease, background-color 0.25s ease; }
        .small { font-size: 0.8rem; color: #777; margin-top: 6px; text-align: center; }
        @keyframes flash-green { 0% { background-color: #c8f7c5; } 100% { background-color: #f5f5f5; } }
        @keyframes flash-red { 0% { background-color: #ffb3b3; } 100% { background-color: #f5f5f5; } }
        body.flash-green { animation: flash-green 0.5s ease-out; }
        .toast-overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; opacity: 0; transition: opacity .15s ease; z-index: 9999; }
        .toast-overlay.show { opacity: 1; }
        .toast { max-width: 90vw; background: rgba(30,30,30,0.92); color: #fff; padding: 10px 14px; border-radius: 14px; font-weight: 700; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
        body.flash-red { animation: flash-red 0.5s ease-out 1; }
        .small-toggle { display: none; margin: 6px 0 10px; padding: 6px 10px; border-radius: 999px; font-size: 0.85rem; }
        @media (max-width: 600px) { body { padding: 10px; font-size: 15px; } h1 { font-size: 1.2rem; margin-top: 12px; } .input-row { flex-direction: column; } .input-row button { width: 100%; } .next-ex-btn-wrap button { min-height: 48px; padding: 12px 16px; } .top-row { flex-direction: column; align-items: stretch; } select { width: 100%; } .toggle-explain-row { text-align: left; } }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.45); display: none; align-items: center; justify-content: center; z-index: 9999; padding: 16px; }
        .modal { width: min(520px, 100%); background: #fff; border-radius: 14px; box-shadow: 0 18px 60px rgba(0,0,0,0.25); padding: 18px 18px 14px; }
        .modal h2 { margin: 0 0 10px; font-size: 1.2rem; }
        .modal p { margin: 0 0 14px; line-height: 1.35; white-space: pre-wrap; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; }
        .modal-actions button { padding: 10px 14px; border-radius: 10px; border: 1px solid #cfcfcf; background: #fff; cursor: pointer; font-weight: 600; }
        .modal-actions button.primary { border-color: #222; background: #222; color: #fff; }
        .modal-actions button.primary:hover:enabled { background: #333; color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .exercise-preview-overlay { position: fixed !important; inset: 0 !important; background: rgba(0,0,0,0.45); display: none !important; align-items: center; justify-content: center; z-index: 10050 !important; padding: 14px; }
        .exercise-preview-overlay.is-open { display: flex !important; }
        .exercise-preview-modal { width: min(760px, 100%); max-height: min(86vh, 900px); background: #fff; border-radius: 16px; border: 1px solid #ddd; box-shadow: 0 18px 60px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; }
        .exercise-preview-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 12px 14px 10px; border-bottom: 1px solid #eee; }
        .exercise-preview-title { margin: 0; font-size: 1.06rem; line-height: 1.25; }
        .exercise-preview-close { border-radius: 10px; min-width: 38px; min-height: 38px; font-size: 1.1rem; font-weight: 700; padding: 4px 10px; }
        .exercise-preview-body { padding: 12px 14px; overflow: auto; min-height: 0; flex: 1 1 auto; }
        .exercise-preview-actions { display: flex; justify-content: center; gap: 10px; padding: 10px 14px 14px; border-top: 1px solid #eee; }
        .exercise-preview-actions button { border-radius: 10px; }
        .exercise-preview-actions .primary { border-color: #222; background: #222; color: #fff; }
    </style>
</head>
<body>
    <div id="app-content-wrap" class="app-content-wrap">
    <div id="course-home-page" class="page" style="display:none;"></div>
    <div id="main-page" class="page" style="display:none;">
        <div id="topPanel">
            <div class="training-close-bar">
                <button type="button" id="btn-training-close" class="btn-training-close" aria-label="Close">× Закрити</button>
            </div>
            <div class="top-row">
                <div class="block-selector-label" id="block-select-label">Go to exercise:</div>
                <select id="block-select"></select>
            </div>
            <div class="block-header"><div class="block-title" id="block-title"></div></div>
            <div class="block-progress"><span class="progress-dot"></span><span id="block-progress-text"></span></div>
        </div>
        <button id="btn-topPanel" class="small-toggle">Show panel</button>
        <div class="exercise-step" id="exercise-step"></div>
        <div id="stage-bar-wrap" aria-label="Progress"><div id="stage-bar"></div></div>
        <div class="toggle-explain-row">
            <button id="btn-toggle-explain">Hide explanation</button>
        </div>
        <div id="explain" class="explain"></div>
        <div id="ex1" class="card" style="display:none;">
            <div class="card-title">Stage 1</div>
            <div class="label">Source phrase:</div>
            <div id="mc-question" class="question"></div>
            <div class="label">Choose correct translation:</div>
            <div id="mc-options" class="options"></div>
            <div id="mc-feedback" class="feedback"></div>
            <button id="mc-next" class="primary">Next word in this exercise</button>
        </div>
        <div id="ex2" class="card" style="display:none;">
            <div class="card-title">Stage 2</div>
            <div class="label">Source phrase:</div>
            <div id="w-question" class="question"></div>
            <div class="label">Write translation:</div>
            <div class="input-row">
                <input id="w-input" type="text" autocomplete="off">
                <button id="w-check">Check</button>
            </div>
            <div id="w-feedback" class="feedback"></div>
            <button id="w-show">Show answer</button>
            <button id="w-next" class="primary">Next word in this exercise</button>
        </div>
        <div id="ex3" class="card" style="display:none;">
            <div class="card-title">Stage 3</div>
            <div class="label">Source text:</div>
            <div id="s-question" class="question"></div>
            <div class="label">Translate:</div>
            <div class="input-row">
                <textarea id="s-input" rows="3" autocomplete="off"></textarea>
                <button id="s-check">Check</button>
            </div>
            <div id="s-feedback" class="feedback"></div>
            <button id="s-show">Show answer</button>
            <button id="s-next" class="primary">Next sentence in this exercise</button>
        </div>
        <div class="next-ex-btn-wrap">
            <button id="btn-restart" class="primary">Restart this exercise</button>
            <button id="btn-next-ex" class="primary">Start exercises</button>
        </div>
        <div id="stats" class="stats"></div>
        <div class="small">Stats are stored while this page is open.</div>
    </div>
    <div id="tabbed-window" class="tabbed-window" style="display:none;">
        <div class="tabbed-window-header" id="tabbed-window-header" aria-hidden="true"><span id="tabbed-window-header-text"></span></div>
        <div class="tabbed-window-content">
    <div id="settings-page" class="page" style="display:none;">
        <div class="settings-content">
            <h1 id="settings-page-title">Settings</h1>
            <div id="settings-toolbar">
                <div class="settings-group"><select id="settings-course-select"></select></div>
                <div class="settings-group"><select id="settings-theme-select"></select></div>
                <div class="settings-group"><button type="button" id="settings-dev-mode-btn" class="settings-btn">Enter dev code</button></div>
            </div>
            <button id="btn-settings-back" class="primary">Back</button>
        </div>
    </div>
    <div id="exercises-page" class="page" style="display:none;">
        <div class="settings-content">
            <h1 id="exercises-page-title">Exercises</h1>
            <div id="exercises-subtitle">Select exercise number</div>
            <div id="exercise-buttons"></div>
            <button id="btn-exercises-back" class="primary">Back</button>
            </div>
    </div>
    </div>
    <nav id="bottom-tabs" class="bottom-tabs" aria-label="Головна навігація">
        <button type="button" id="tab-exercises" class="tab-btn active" data-tab="exercises">Вправи</button>
        <button type="button" id="tab-settings" class="tab-btn" data-tab="settings">Налаштування</button>
    </nav>
    </div>
    </div>
    <div id="exercises-preview-modal" class="exercise-preview-overlay" aria-hidden="true">
        <div class="exercise-preview-modal" role="dialog" aria-modal="true" aria-labelledby="ex-preview-title">
            <div class="exercise-preview-head">
                <h2 id="ex-preview-title" class="exercise-preview-title"></h2>
                <button type="button" id="ex-preview-close-x" class="exercise-preview-close" aria-label="Close">&times;</button>
            </div>
            <div id="ex-preview-body" class="exercise-preview-body"></div>
            <div class="exercise-preview-actions">
                <button type="button" id="ex-preview-start" class="primary">Start exercises</button>
            </div>
        </div>
    </div>
    <div id="toastOverlay" class="toast-overlay" aria-hidden="true"><div id="toastMsg" class="toast"></div></div>
    <div id="modalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal">
            <h2 id="modalTitle">Done</h2>
            <p id="modalText"></p>
            <div class="modal-actions">
                <button id="modalSecondary">Try again</button>
                <button id="modalPrimary" class="primary">Next</button>
                <button id="modalTertiary" class="secondary">Repeat exercise</button>
            </div>
        </div>
    </div>
    <script>
        (function() {
            var pathname = window.location.pathname || "/";
            var inRoot = pathname.indexOf("root") >= 0;
            var course = "english";
            var BUILD_VERSION = "2026-02-26-training-compact-topbar-2";
            var params = new URLSearchParams(window.location.search || "");
            var c = params.get("course");
            if (c === "english" || c === "spanish" || c === "russian") course = c;
            function scriptPath(relativePath) {
                if (inRoot) return "../" + relativePath;
                var base = pathname.replace(/\/[^/]*$/, "").replace(/\/$/, "") || "";
                if (base && base.charAt(0) !== "/") base = "/" + base;
                var useRelative = window.location.protocol === "file:" || !window.location.origin || window.location.origin === "null";
                if (useRelative) return relativePath;
                return (base ? base + "/" : "/") + relativePath;
            }
            function loadScript(src, cb) {
                var s = document.createElement("script");
                s.src = src;
                s.onload = cb;
                s.onerror = function() { if (cb) cb(); };
                document.body.appendChild(s);
            }
            loadScript(scriptPath(course + "/js/course_config.js") + "?course=" + encodeURIComponent(course) + "&v=" + encodeURIComponent(BUILD_VERSION), function() {
                if (window.COURSE_CONFIG && window.COURSE_CONFIG.uiLang) try { document.documentElement.lang = window.COURSE_CONFIG.uiLang; } catch (e) {}
                loadScript(scriptPath("shared/js/app.js") + "?v=" + encodeURIComponent(BUILD_VERSION), function() {
                    (function() {
                        var homePage = document.getElementById("course-home-page");
                        var mainPage = document.getElementById("main-page");
                        var settingsPage = document.getElementById("settings-page");
                        var exercisesPage = document.getElementById("exercises-page");
                        var appContentWrap = document.getElementById("app-content-wrap");
                        var tabbedWindow = document.getElementById("tabbed-window");
                        var bottomTabs = document.getElementById("bottom-tabs");
                        var tabExercisesBtn = document.getElementById("tab-exercises");
                        var tabSettingsBtn = document.getElementById("tab-settings");
                        var btnTrainingClose = document.getElementById("btn-training-close");
                        var btnSettingsBack = document.getElementById("btn-settings-back");
                        var settingsCourseSelect = document.getElementById("settings-course-select");
                        var settingsThemeSelect = document.getElementById("settings-theme-select");
                        var settingsDevModeBtn = document.getElementById("settings-dev-mode-btn");
                        var exercisesTitleEl = document.getElementById("exercises-page-title");
                        var exercisesSubtitleEl = document.getElementById("exercises-subtitle");
                        var tabbedWindowHeaderText = document.getElementById("tabbed-window-header-text");
                        var settingsPageTitleEl = document.getElementById("settings-page-title");
                        var exerciseButtonsWrap = document.getElementById("exercise-buttons");
                        var btnExercisesBack = document.getElementById("btn-exercises-back");
                        var exPreviewModal = document.getElementById("exercises-preview-modal");
                        var exPreviewTitle = document.getElementById("ex-preview-title");
                        var exPreviewBody = document.getElementById("ex-preview-body");
                        var exPreviewCloseX = document.getElementById("ex-preview-close-x");
                        var exPreviewStart = document.getElementById("ex-preview-start");
                        var previewExerciseIndex = null;

                        function setBrandTitle(id, value) {
                            var el = document.getElementById(id);
                            if (!el || !value) return;
                            var icon = el.querySelector(".landing-brand-icon");
                            if (!icon) {
                                icon = document.createElement("span");
                                icon.className = "landing-brand-icon";
                                icon.setAttribute("aria-hidden", "true");
                            }
                            el.textContent = value;
                            el.appendChild(icon);
                        }

                                                function initBrandIconRender() {
                            var htmlEl = document.documentElement;
                            if (!htmlEl) return;
                            htmlEl.classList.remove("brand-icon-ready");
                            var supportsMask = false;
                            try {
                                supportsMask = !!(window.CSS && window.CSS.supports && (
                                    window.CSS.supports("-webkit-mask-image", "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAusB9Y5n2QAAAABJRU5ErkJggg==')") ||
                                    window.CSS.supports("mask-image", "url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAusB9Y5n2QAAAABJRU5ErkJggg==')")
                                ));
                            } catch (e) {}
                            if (!supportsMask) return;
                            var iconDataUrl = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAQAAAD2e2DtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGNGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgMTAuMC1jMDAwIDI1LkcuZDIwZTQ2NiwgMjAyNS8xMi8wOC0yMDo1MDoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI3LjQgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNi0wMi0yNlQwNToxOTozOCswMjowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjYtMDItMjZUMDU6MjI6MDgrMDI6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjYtMDItMjZUMDU6MjI6MDgrMDI6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIxIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjg4MTJlNDdiLWM2ZDgtN2Y0Zi05Y2ZlLWRkM2QxYjg5ZDAyZiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQzYWQ5OGQwLTQyYTUtOTM0OS05ZDQ2LWFjNjM1MWRlODY2MyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjU2Nzk1YzUzLTdhNmEtMmY0Yi05N2QxLTEwYTFmODNmN2Q4MiI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NTY3OTVjNTMtN2E2YS0yZjRiLTk3ZDEtMTBhMWY4M2Y3ZDgyIiBzdEV2dDp3aGVuPSIyMDI2LTAyLTI2VDA1OjE5OjM4KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjcuNCAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6ODgxMmU0N2ItYzZkOC03ZjRmLTljZmUtZGQzZDFiODlkMDJmIiBzdEV2dDp3aGVuPSIyMDI2LTAyLTI2VDA1OjIyOjA4KzAyOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjcuNCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+mXYj3wAAEJlJREFUeJztnQlwVdUZx/8f0SCIBAMYpOIgCpYIShV1jFoUkUUcrDPUjVodB62iw2itG1Y7jhjt4F5RUOrCyKjolLohIkJaFVRQWSSCYFygIYiCgYTs7+sQXva33XvPcpfvd4d5L+/dc87H+/73O+eeexZiCFGmk20DBLuIACKOCCDiiAAijggg4ogAIo4I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";
                            htmlEl.style.setProperty("--brand-icon-url", 'url("' + iconDataUrl + '")');
                            htmlEl.classList.add("brand-icon-ready");
                        }

                        function showPage(name) {
                            var isMain = name === "main";
                            var isExercises = name === "exercises";
                            var isSettings = name === "settings";
                            mainPage.style.display = isMain ? "block" : "none";
                            if (tabbedWindow) {
                                tabbedWindow.style.display = (isExercises || isSettings) ? "flex" : "none";
                                tabbedWindow.classList.remove("tab-exercises", "tab-settings");
                                if (isExercises) tabbedWindow.classList.add("tab-exercises");
                                if (isSettings) tabbedWindow.classList.add("tab-settings");
                            }
                            exercisesPage.style.display = isExercises ? "block" : "none";
                            settingsPage.style.display = isSettings ? "block" : "none";
                            if (bottomTabs) bottomTabs.style.display = isMain ? "none" : "flex";
                            if (appContentWrap) appContentWrap.classList.toggle("tabs-pages-visible", isExercises || isSettings);
                            document.body.classList.toggle("tabs-pages-visible", isExercises || isSettings);
                            document.documentElement.classList.toggle("tabs-pages-visible", isExercises || isSettings);
                            if (tabExercisesBtn) tabExercisesBtn.classList.toggle("active", isExercises);
                            if (tabSettingsBtn) tabSettingsBtn.classList.toggle("active", isSettings);
                            if (tabbedWindowHeaderText) {
                                if (isExercises) tabbedWindowHeaderText.textContent = exercisesTitleEl ? exercisesTitleEl.textContent : "Вправи";
                                else if (isSettings) tabbedWindowHeaderText.textContent = settingsPageTitleEl ? settingsPageTitleEl.textContent : "Налаштування";
                            }
                        }

                        function showSettingsPage() {
                            showPage("settings");
                            initSettingsPage();
                        }

                        function showMainPage() {
                            showPage("main");
                        }

                        function showExercisesPage() {
                            showPage("exercises");
                            initExercisesPage();
                        }

                        window.onAppReady = function() {
                            showExercisesPage();
                        };

                        function openExercise(index, options) {
                            var blockSelect = document.getElementById("block-select");
                            var startBtn = document.getElementById("btn-next-ex");
                            var ex1 = document.getElementById("ex1");
                            var ex2 = document.getElementById("ex2");
                            var ex3 = document.getElementById("ex3");
                            var idx = parseInt(index, 10);
                            var skipResume = !!(options && options.skipResume);
                            showMainPage();
                            if (!blockSelect || isNaN(idx)) return;
                            // Resume only when user selected the same exercise they left.
                            if (!skipResume && window.resumeProgressForBlock && window.resumeProgressForBlock(idx)) {
                                window.scrollTo({ top: 0, behavior: "smooth" });
                                return;
                            }
                            blockSelect.value = String(idx);
                            blockSelect.dispatchEvent(new Event("change", { bubbles: true }));
                            if (startBtn && ex1 && ex2 && ex3) {
                                // If old progress/config still lands on intro (all cards hidden), force-start stage 1.
                                var atIntro = ex1.style.display !== "block" && ex2.style.display !== "block" && ex3.style.display !== "block";
                                if (atIntro) startBtn.click();
                            }
                            window.scrollTo({ top: 0, behavior: "smooth" });
                        }

                        function showExercisePreview(index, fallbackTitle) {
                            var ui = window.COURSE_CONFIG && window.COURSE_CONFIG.ui ? window.COURSE_CONFIG.ui : {};
                            if (!exPreviewModal || !exPreviewTitle || !exPreviewBody) return;
                            var idx = parseInt(index, 10);
                            var preview = window.getExercisePreviewData ? window.getExercisePreviewData(idx) : null;
                            var titleText = (preview && preview.title) ? preview.title : (fallbackTitle || "");
                            var bodyHtml = (preview && preview.explanationHtml) ? preview.explanationHtml : "";
                            previewExerciseIndex = idx;
                            exPreviewTitle.textContent = titleText;
                            if (bodyHtml && bodyHtml.trim()) {
                                exPreviewBody.innerHTML = bodyHtml;
                            } else {
                                exPreviewBody.textContent = ui.noDescriptionText || "";
                            }
                            if (exPreviewStart) exPreviewStart.textContent = ui.startExercises || "Start";
                            exPreviewModal.classList.add("is-open");
                            exPreviewModal.setAttribute("aria-hidden", "false");
                            document.body.classList.add("modal-open");
                        }

                        function closeExercisePreview() {
                            if (exPreviewModal) {
                                exPreviewModal.classList.remove("is-open");
                                exPreviewModal.setAttribute("aria-hidden", "true");
                            }
                            document.body.classList.remove("modal-open");
                            previewExerciseIndex = null;
                        }

                        function initExercisesPage() {
                            var ui = window.COURSE_CONFIG && window.COURSE_CONFIG.ui ? window.COURSE_CONFIG.ui : {};
                            if (exercisesTitleEl) exercisesTitleEl.textContent = ui.exercisesTitle || "Exercises";
                            if (exercisesSubtitleEl) exercisesSubtitleEl.textContent = ui.exercisesHint || "Choose exercise";
                            if (btnExercisesBack) btnExercisesBack.textContent = ui.settingsBack || "Back";
                            if (!exerciseButtonsWrap) return;
                            exerciseButtonsWrap.innerHTML = "";
                            var blockSelect = document.getElementById("block-select");
                            if (!blockSelect || !blockSelect.options) return;
                            var resumeBlockIndex = (window.getSavedProgressBlockIndex ? window.getSavedProgressBlockIndex() : -1);
                            Array.prototype.forEach.call(blockSelect.options, function(opt, idx) {
                                var btn = document.createElement("button");
                                var fallbackNumber = idx + 1;
                                var fullLabel = (opt.textContent || ((ui.blockTitlePrefix || "Exercise ") + fallbackNumber)).replace(/\s+/g, " ").trim();
                                var m = fullLabel.match(/^\s*(\d+)\.\s*(.*)$/);
                                var numText = m ? (m[1] + ".") : String(fallbackNumber) + ".";
                                var titleText = m ? m[2] : fullLabel;
                                var num = document.createElement("span");
                                var title = document.createElement("span");
                                btn.type = "button";
                                btn.className = "exercise-nav-btn";
                                num.className = "exercise-nav-num";
                                title.className = "exercise-nav-title";
                                num.textContent = numText;
                                title.textContent = titleText;
                                btn.appendChild(num);
                                btn.appendChild(title);
                                btn.title = fullLabel;
                                var targetIndex = parseInt(opt.value, 10);
                                if (!isNaN(targetIndex) && targetIndex === resumeBlockIndex) {
                                    btn.classList.add("is-resume-target");
                                }
                                btn.addEventListener("click", function() {
                                    if (!isNaN(targetIndex) && targetIndex === resumeBlockIndex) {
                                        if (window.promptResumeBeforeExercises) {
                                            var shown = window.promptResumeBeforeExercises({
                                                onContinue: function() {
                                                    showMainPage();
                                                    window.scrollTo({ top: 0, behavior: "smooth" });
                                                },
                                                onRestart: function() {
                                                    openExercise(targetIndex, { skipResume: true });
                                                }
                                            });
                                            if (shown) return;
                                        }
                                        openExercise(targetIndex);
                                        return;
                                    }
                                    showExercisePreview(targetIndex, fullLabel);
                                });
                                exerciseButtonsWrap.appendChild(btn);
                            });
                        }

                        function initSettingsPage() {
                            var ui = window.COURSE_CONFIG && window.COURSE_CONFIG.ui ? window.COURSE_CONFIG.ui : {};
                            var DEV_CODE = "19337";
                            if (settingsCourseSelect) {
                                settingsCourseSelect.innerHTML = "";
                                var currentCourse = window.getCurrentCourse ? window.getCurrentCourse() : "english";
                                var courseLabels = { english: ui.courseOptionEnglish || "English", spanish: ui.courseOptionSpanish || "Spanish", russian: ui.courseOptionRussian || "Russian" };
                                ["english", "spanish", "russian"].forEach(function(v) {
                                    var opt = document.createElement("option");
                                    opt.value = v;
                                    opt.textContent = courseLabels[v] || v;
                                    settingsCourseSelect.appendChild(opt);
                                });
                                settingsCourseSelect.value = currentCourse;
                                settingsCourseSelect.onchange = function() {
                                    var pathname = window.location.pathname || "";
                                    if (pathname.indexOf("root") < 0) {
                                        window.location.href = "index.html?course=" + settingsCourseSelect.value;
                                        return;
                                    }
                                    var b = window.getBasePrefix ? window.getBasePrefix() : "";
                                    var isRoot = b === "root" || b === "/root" || (b && b.replace(/\/$/, "").endsWith("root"));
                                    var prefix = isRoot ? "" : (b ? b + "/" : (window.location.protocol === "file:" || !window.location.origin ? "" : "/"));
                                    window.location.href = (isRoot ? "index.html" : prefix + "index.html") + "?course=" + settingsCourseSelect.value;
                                };
                            }
                            if (settingsThemeSelect) {
                                settingsThemeSelect.innerHTML = "";
                                [{ value: "classic", text: "Classic" }, { value: "cyberpunk", text: "Cyberpunk" }, { value: "kawaii", text: "Kawaii Hearts" }].forEach(function(t) {
                                    var opt = document.createElement("option");
                                    opt.value = t.value;
                                    opt.textContent = t.text;
                                    settingsThemeSelect.appendChild(opt);
                                });
                                settingsThemeSelect.value = window.getTheme ? window.getTheme() : "classic";
                                settingsThemeSelect.onchange = function() { if (window.setTheme) window.setTheme(settingsThemeSelect.value); };
                            }
                            if (settingsDevModeBtn) {
                                function updateDevModeButton() {
                                    var isDev = window.isDevMode ? window.isDevMode() : false;
                                    settingsDevModeBtn.textContent = isDev ? (ui.devModeButtonLabel || "Exit developer mode") : (ui.devModeEnterCodeLabel || "Enter dev code");
                                    settingsDevModeBtn.classList.toggle("dev-mode-active", isDev);
                                }
                                updateDevModeButton();
                                settingsDevModeBtn.onclick = function() {
                                    if (!window.isDevMode || !window.setDevMode || !window.openModal) return;
                                    var isDev = window.isDevMode();
                                    if (isDev) {
                                        window.openModal({ title: ui.devModeButtonLabel || "Dev", text: ui.devModeConfirmDisable || "", primaryText: ui.ok || "OK", secondaryText: ui.devModeCancel || "Cancel", onPrimary: function() { window.setDevMode(false); updateDevModeButton(); }, onSecondary: function() {} });
                                    } else {
                                        var input = window.prompt(ui.devModePromptText || "Code:");
                                        if (input === null) return;
                                        if (input.trim() === DEV_CODE) {
                                            window.openModal({ title: ui.devModeButtonLabel || "Dev", text: ui.devModeConfirmEnable || "", primaryText: ui.ok || "OK", secondaryText: ui.devModeCancel || "Cancel", onPrimary: function() { window.setDevMode(true); updateDevModeButton(); }, onSecondary: function() {} });
                                        } else { alert(ui.devModeWrongCode || "Unknown command"); }
                                    }
                                };
                            }
                        }
                        function normalizeStaticText() {
                            var ui = window.COURSE_CONFIG && window.COURSE_CONFIG.ui ? window.COURSE_CONFIG.ui : {};
                            var setText = function(id, value) { var el = document.getElementById(id); if (el && value) el.textContent = value; };
                            var setFirst = function(selector, value) { var el = document.querySelector(selector); if (el && value) el.textContent = value; };

                            var appTitle = ui.appTitle || "U MUST LEARN";
                            document.title = appTitle;
                            setText("block-select-label", ui.goToExerciseLabel || "Go to exercise:");
                            setText("btn-topPanel", ui.showPanel || "Show panel");
                            setText("btn-toggle-explain", ui.hideExplain || "Hide explanation");
                            setText("tab-exercises", ui.tabExercises || ui.exercisesTitle || "Exercises");
                            setText("tab-settings", ui.tabSettings || ui.settingsTitle || "Settings");
                            setText("btn-training-close", ui.trainingClose || "Close");
                            setText("mc-next", ui.nextWordInExercise || "Next word in this exercise");
                            setText("w-check", ui.check || "Check");
                            setText("w-show", ui.showAnswer || "Show answer");
                            setText("w-next", ui.nextWordInExercise || "Next word in this exercise");
                            setText("s-check", ui.check || "Check");
                            setText("s-show", ui.showAnswer || "Show answer");
                            setText("s-next", ui.nextSentenceInExercise || "Next sentence in this exercise");
                            setText("btn-restart", ui.restartExercise || "Restart this exercise");
                            setText("btn-next-ex", ui.startExercises || "Start exercises");
                            setText("settings-page-title", ui.settingsTitle || "Settings");
                            setText("settings-dev-mode-btn", ui.devModeEnterCodeLabel || "Enter dev code");
                            setText("btn-settings-back", ui.settingsBack || "Back");
                            setText("exercises-page-title", ui.exercisesTitle || "Exercises");
                            setText("exercises-subtitle", ui.exercisesHint || "Select exercise number");
                            setText("btn-exercises-back", ui.settingsBack || "Back");
                            setText("ex-preview-start", ui.startExercises || "Start exercises");
                            setText("modalTitle", ui.doneTitle || "Done");
                            setText("modalSecondary", ui.tryAgain || "Try again");
                            setText("modalPrimary", ui.next || "Next");
                            setText("modalTertiary", ui.repeatExercise || "Repeat exercise");

                            setFirst("#ex1 .card-title", ui.stage1CardTitle || "Stage 1");
                            setFirst("#ex2 .card-title", ui.stage2CardTitle || "Stage 2");
                            setFirst("#ex3 .card-title", ui.stage3CardTitle || "Stage 3");
                            setFirst("#ex1 .label", ui.uaPhraseLabel || "Source phrase:");
                            setFirst("#ex1 .label:nth-of-type(2)", ui.chooseTranslationLabel || "Choose correct translation:");
                            setFirst("#ex2 .label", ui.uaPhraseLabel || "Source phrase:");
                            setFirst("#ex2 .label:nth-of-type(2)", ui.writeTranslationLabel || "Write translation:");
                            setFirst("#ex3 .label", ui.uaTextLabel || "Source text:");
                            setFirst("#ex3 .label:nth-of-type(2)", ui.translateLabel || "Translate:");
                            setFirst(".small", ui.sessionStatsHint || "Stats are stored while this page is open.");
                        }
                        initBrandIconRender();
                        normalizeStaticText();
                        if (tabExercisesBtn) tabExercisesBtn.addEventListener("click", function() { showExercisesPage(); });
                        if (tabSettingsBtn) tabSettingsBtn.addEventListener("click", function() { showSettingsPage(); });
                        if (btnTrainingClose) btnTrainingClose.addEventListener("click", function() { showExercisesPage(); window.scrollTo({ top: 0, behavior: "smooth" }); });
                        if (btnSettingsBack) btnSettingsBack.addEventListener("click", function() { showExercisesPage(); });
                        if (btnExercisesBack) btnExercisesBack.addEventListener("click", function() { showExercisesPage(); });
                        if (exPreviewCloseX) exPreviewCloseX.addEventListener("click", function() { closeExercisePreview(true); });
                        if (exPreviewModal) exPreviewModal.addEventListener("click", function(e) { if (e.target === exPreviewModal) closeExercisePreview(true); });
                        if (exPreviewStart) exPreviewStart.addEventListener("click", function() {
                            var i = previewExerciseIndex;
                            closeExercisePreview(false);
                            if (i !== null && !isNaN(i)) openExercise(i);
                        });
                        showPage("exercises");
                    })();
                });
            });
        })();
    </script>
</body>
</html>

