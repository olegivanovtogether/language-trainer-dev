# Актуальний об'єднаний план (стан на 2026-02-28)

Цей файл є єдиним робочим планом по логіці вправ.
Він об'єднує:
1. План етапу 1 (main/remediation, штрафи, шкали).
2. План фіксу завершення етапу 2 (sent).

---

## 1) Межі змін

1. Основна логіка тренування змінюється в `shared/js/app.js`.
2. Дозволені точкові зміни поза `app.js`, якщо це технічна необхідність (наприклад cache-bust версія в `root/index.html`).
3. Тексти/локалі/стилі не змінювати без окремої задачі.

---

## 2) Етап 1: база + виправлення помилок

1. Етап 1 є єдиним етапом з двома режимами:
   - `main`: батчі `MC -> Write` (3/5 за правилом розміру списку).
   - `remediation`: тільки `Write` по списку помилок.
2. Помилки з `MC` і `Write` потрапляють у спільний пул.
3. Після `main`:
   - якщо пул порожній -> перехід на етап 2;
   - якщо не порожній -> remediation до 3 раундів.
4. Кожен наступний раунд remediation будується лише з помилок попереднього.

Статус: `виконано`.

---

## 3) Штрафи і відкати (якорі 3/5)

1. Лічильник страйків у межах поточного проходу: 3 помилки -> штраф.
2. Відкат іде до початку поточного якоря:
   - для малих наборів `R=3`,
   - для великих `R=5`.
3. Антидемотивація: на першому кроці 3 помилки не відкидають назад.
4. Після штрафу лічильник страйків обнуляється і цикл починається заново.

Статус: `виконано`.

---

## 4) Прогрес-бари

1. Окрема шкала для `main` етапу 1.
2. Окрема шкала для `remediation` (поточний раунд).
3. Шкали не змішуються.

Статус: `виконано`.

---

## 5) Збереження/відновлення

1. Зберігаються ключові поля проходу (позиції, черги, раунди remediation, страйки).
2. Після reload відновлюється поточний режим і позиція.

Статус: `виконано`.

---

## 6) Етап 2 (sent) завершення

1. Завершення етапу 2 має спрацьовувати гарантовано при кінці черги.
2. Для неостанньої вправи:
   - модалка завершення,
   - перехід до наступної вправи або повтор.
3. Для останньої вправи:
   - окрема фінальна модалка,
   - дії: повторити вправу або повернутись до списку вправ.
4. Усунуто зациклення фінальної картки (`off-by-one` по позиції черги).

Статус: `реалізовано в коді`, потребує фінальної ручної валідації.

---

## 7) Що зроблено поза первинними планами

1. Оновлено `BUILD_VERSION` у `root/index.html` для пробиття кешу фронту.

---

## 8) Що ще треба зробити

1. Ручний QA по 3 сценаріях:
   - Неостання вправа: кінець етапу 2 -> модалка -> перехід на наступну/повтор.
   - Остання вправа: кінець етапу 2 -> тільки фінальна модалка (повторити/до списку вправ).
   - Перезавантаження сторінки в середині етапу 1 і remediation -> коректне відновлення позиції/життів/прогресу.
2. Перевірити всі 3 курси (`english`, `spanish`, `russian`) на однакову поведінку кнопок у фінальних модалках.
3. Зафіксувати результат QA (окремим коротким звітом або чеклістом у репо).

---

## 9) Критерій повної готовності

1. Немає "тиші" на 100% етапу 2.
2. Немає нескінченного циклу останнього речення.
3. На останній вправі немає переходу на "неіснуючу наступну".
4. Логіка етапу 1 (main/remediation, штрафи, шкали) не деградує.

